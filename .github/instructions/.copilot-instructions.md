---
applyTo: '**'
---

# Copilot Instructions for Team 3 Job Application Backend

## üìã **Read This First**
Always read this file when starting any new task or conversation about this project to understand the context, architecture, and conventions.

## üèóÔ∏è **Project Overview**
- **Name**: Team 3 Job Application Backend
- **Type**: TypeScript/Node.js REST API
- **Architecture**: 3-tier architecture (Controllers, Services, Repositories)
- **Database**: SQLite with Drizzle ORM
- **Framework**: Express.js 5.1.0
- **Language**: TypeScript 5.3.3 (strict mode)
- **API**: RESTful JSON endpoints

## üìÅ **Project Structure**
```
src/
‚îú‚îÄ‚îÄ controllers/          # HTTP request handlers (Presentation layer)
‚îÇ   ‚îú‚îÄ‚îÄ ApplicationController.ts
‚îÇ   ‚îî‚îÄ‚îÄ JobController.ts
‚îú‚îÄ‚îÄ services/             # Business logic (Business Logic layer)
‚îÇ   ‚îú‚îÄ‚îÄ ApplicationService.ts
‚îÇ   ‚îú‚îÄ‚îÄ JobService.ts
‚îÇ   ‚îú‚îÄ‚îÄ SchedulerService.ts
‚îÇ   ‚îî‚îÄ‚îÄ *.test.ts        # Service tests
‚îú‚îÄ‚îÄ repositories/         # Data access (Data Access layer)
‚îÇ   ‚îú‚îÄ‚îÄ ApplicationRepository.ts
‚îÇ   ‚îî‚îÄ‚îÄ JobRepository.ts
‚îú‚îÄ‚îÄ models/               # Data models and interfaces
‚îú‚îÄ‚îÄ routes/               # Route definitions
‚îú‚îÄ‚îÄ middleware/           # Custom Express middleware
‚îÇ   ‚îú‚îÄ‚îÄ adminAuth.ts     # Admin authorization
‚îÇ   ‚îú‚îÄ‚îÄ appSetup.ts      # App configuration
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îú‚îÄ‚îÄ db/                   # Database configuration
‚îÇ   ‚îú‚îÄ‚îÄ schema.ts        # Drizzle schema definitions
‚îÇ   ‚îî‚îÄ‚îÄ database.ts      # DB connection setup
‚îú‚îÄ‚îÄ di/                   # Dependency Injection
‚îú‚îÄ‚îÄ seeds/                # Database seeders
‚îú‚îÄ‚îÄ app.ts                # Express app factory
‚îú‚îÄ‚îÄ server.ts             # Server entry point
‚îî‚îÄ‚îÄ index.ts              # Application entry point

drizzle/                  # Database migrations
‚îú‚îÄ‚îÄ migrations/           # SQL migration files
‚îî‚îÄ‚îÄ meta/

tests/                    # E2E and integration tests (future)
vitest.config.ts          # Vitest configuration
```

## üõ†Ô∏è **Technology Stack**
- **Runtime**: Node.js >= 18.0.0
- **Language**: TypeScript 5.3.3
- **Framework**: Express.js 5.1.0
- **Database**: SQLite with Drizzle ORM 0.44.6
- **Migration Tool**: Drizzle Kit 0.31.5
- **Testing**: Vitest 3.2.4 with V8 coverage
- **Code Quality**: Biome 2.2.4
- **Task Scheduler**: node-cron 4.2.1
- **Authentication**: JWT with jsonwebtoken 9.0.2
- **Build**: TypeScript Compiler (tsc)
- **Dev Server**: tsx (hot reload)

## üìã **Available Commands**
```bash
# Development
npm run dev              # Start development server with hot reload
npm run build           # Build TypeScript to JavaScript
npm run start           # Start production server
npm run clean           # Remove build artifacts

# Testing (READ testing-instructions.md for detailed info)
npm run test            # Interactive test runner
npm run test:run        # Run all tests once
npm run test:ui         # Test UI in browser
npm run test:coverage   # Generate coverage report

# Code Quality
npm run format          # Format code with Biome
npm run lint           # Lint and fix issues
npm run check          # Full quality check
npm run ci             # CI-optimized check
npm run type-check     # TypeScript type checking

# Database
npm run db:generate    # Generate Drizzle migrations
npm run db:migrate     # Apply migrations
npm run db:push        # Push schema to database
npm run db:studio      # Open Drizzle Studio GUI

# Database Seeding
npm run seed                   # Run all seeders
npm run seed:capabilities     # Seed capabilities
npm run seed:bands            # Seed bands
npm run seed:jobroles         # Seed job roles
```

## üéØ **Code Quality Standards**
- **Biome** for formatting and linting
- **TypeScript strict mode** enabled
- **3-tier architecture** pattern enforced
- **Dependency Injection** for testability
- **RESTful conventions** for API endpoints
- **Comprehensive testing** (see testing-instructions.md)
- **2 spaces** tab indentation in JSON
- **100 character** line width
- **Double quotes** for strings
- **Always semicolons**
- **Trailing commas** where valid

## üì° **Current API Endpoints**

### Job Roles
- `GET /api/jobs` - List all job roles
- `GET /api/jobs/:id` - Get job role by ID
- `POST /api/jobs` - Create new job role (admin only)
- `PATCH /api/jobs/:id` - Update job role (admin only)
- `DELETE /api/jobs/:id` - Delete job role (admin only)

### Applications
- `GET /api/applications` - List all applications (admin)
- `GET /api/applications/:id` - Get application by ID
- `POST /api/applications` - Submit new application
- `PATCH /api/applications/:id/status` - Update status (admin)
- `DELETE /api/applications/:id` - Withdraw application

### Health & Info
- `GET /health` - Health check
- `GET /info` - Application info

## üîÑ **Development Workflow**
1. **Always run quality checks**: `npm run check`
2. **Run tests**: `npm run test:run`
3. **Type check**: `npm run type-check`
4. **Build verification**: `npm run build`
5. **Create/update migrations**: `npm run db:generate` then `npm run db:push`

## üö® **Important Conventions**

### File Naming
- **Controllers**: `*-controller.ts` (kebab-case)
- **Services**: `*-service.ts` (kebab-case)
- **Repositories**: `*-repository.ts` (kebab-case)
- **Models**: `*.ts` (kebab-case file, PascalCase interface)
- **Tests**: `*.test.ts` (co-located with source)

### Code Organization
- **Controllers**: Handle HTTP requests/responses ONLY, call services
- **Services**: Contain ALL business logic and validation rules
- **Repositories**: Handle data access and queries ONLY
- **Models**: Define TypeScript interfaces and types
- **Routes**: Define URL patterns and middleware chains
- **Middleware**: Cross-cutting concerns (auth, logging, validation)

### Layer Separation (CRITICAL)
```
Controller ‚Üí Service ‚Üí Repository ‚Üí Database
    ‚Üì           ‚Üì          ‚Üì
 HTTP         Logic      SQL
Handling      Rules      Queries
```

**Rules**:
- ‚ùå Controllers should NEVER contain business logic
- ‚ùå Services should NEVER directly query the database
- ‚ùå Repositories should NEVER perform business logic
- ‚úÖ Services should call repositories for data access
- ‚úÖ Controllers should call services for business logic
- ‚úÖ Each layer has ONE responsibility

### Error Handling
- Use custom error types or HTTP status codes
- Log errors appropriately (ERROR level for failures)
- Return consistent error response format
- Never expose stack traces to clients

### TypeScript Usage
- **Strict mode** enabled - NO `any` type
- **Explicit types** for all function parameters and returns
- **Interface definitions** in models folder
- **Type guards** for runtime validation
- **Proper error typing** with custom error classes

### Testing Requirements
**See `testing-instructions.md` for comprehensive guide**
- **Unit tests** for all services (70%+ coverage)
- **Integration tests** for controllers (60%+ coverage)
- **Mock external dependencies** (repositories, APIs)
- **Test both happy paths AND error scenarios**

## üîê **Authentication & Authorization**
- JWT-based authentication
- Admin middleware for protected routes
- User info in request context
- Always validate permissions in services

## üìù **Database Management**

### Migrations
```bash
# Create migration after schema changes
npm run db:generate

# Apply pending migrations
npm run db:migrate

# Or use Drizzle Studio for visual editing
npm run db:studio
```

### Seeding
- Seeders in `src/seeds/`
- Run with `npm run seed` or individual seeders
- Always seed after fresh database setup
- Use seeders for development data

## üöÄ **Deployment Notes**
- **Build process**: TypeScript compilation only
- **Environment variables**: DATABASE_URL, JWT secrets, PORT
- **Start command**: `npm run start` or `node dist/server.js`
- **No database migrations in production**: Run before deployment

## ‚ö†Ô∏è **Common Pitfalls to Avoid**
- ‚ùå Business logic in controllers
- ‚ùå HTTP logic in services
- ‚ùå Database queries in repositories called multiple times (use services for caching logic)
- ‚ùå Skipping type definitions
- ‚ùå Committing without `npm run check`
- ‚ùå Ignoring test coverage
- ‚ùå Hardcoding configuration values
- ‚ùå Not validating input in services
- ‚ùå Returning database objects directly (return DTOs)
- ‚ùå Mixing concerns in a single file

## üéØ **When Making Changes**
1. **Understand the 3-tier architecture**
2. **Follow existing patterns and conventions**
3. **Put business logic in Services** (not controllers)
4. **Add comprehensive tests** (see testing-instructions.md)
5. **Use TypeScript strict mode** (no `any` types)
6. **Update migrations if schema changes** (`npm run db:generate`)
7. **Update documentation if needed**
8. **Run all quality checks before committing**
9. **Ensure backward compatibility**

## üìö **Testing Guide**
**READ:** `.github/instructions/testing-instructions.md`
This document contains comprehensive testing standards including:
- Unit test examples for services
- Integration test examples for controllers
- Mocking patterns and best practices
- Coverage requirements and targets
- Common test pitfalls

## üìû **Support & Resources**
- **Architecture**: This document and README.md
- **API Documentation**: README.md API Endpoints section
- **Testing Guide**: `.github/instructions/testing-instructions.md`
- **Code Quality**: Biome configuration in project root
- **Database Schema**: `src/db/schema.ts` and Drizzle documentation
- **Authentication**: See middleware/adminAuth.ts for examples

---
**Always refer to the README.md for the most up-to-date information and detailed instructions.**
